<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Регистрация</title>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div class="container">
        <nav class="navbar">
            <a href="index.html" class="nav-brand">Тестирование компетенций</a>
            <!-- Убираем кнопку "На главную" -->
        </nav>

        <main class="auth-container">
            <div class="auth-card">
                <h2>Регистрация</h2>
                <p class="auth-subtitle">Создайте учетную запись</p>

                <form id="registerForm">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required placeholder="example@company.com">
                    </div>

                    <div class="form-group">
                        <label for="firstName">Имя</label>
                        <input type="text" id="firstName" name="firstName" required placeholder="Иван">
                    </div>

                    <div class="form-group">
                        <label for="lastName">Фамилия</label>
                        <input type="text" id="lastName" name="lastName" required placeholder="Иванов">
                    </div>

                    <div class="form-group">
                        <label for="password">Пароль</label>
                        <input type="password" id="password" name="password" required placeholder="Минимум 6 символов">
                    </div>

                    <div class="form-group">
                        <label for="confirmPassword">Подтверждение пароля</label>
                        <input type="password" id="confirmPassword" name="confirmPassword" required
                            placeholder="Повторите пароль">
                    </div>

                    <div class="form-group">
                        <label for="role">Кем вы будете пользоваться системой?</label>
                        <select id="role" name="role" required>
                            <option value="">Выберите роль</option>
                            <option value="EMPLOYEE">Я сотрудник (буду проходить тесты)</option>
                            <option value="HR">Я HR-специалист (буду создавать тесты)</option>
                        </select>
                    </div>

                    <div class="form-group" style="margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary btn-block">
                            Зарегистрироваться
                        </button>
                    </div>
                </form>

                <div class="auth-footer">
                    <p>Уже есть аккаунт? <a href="login.html">Войти</a></p>
                    <p style="margin-top: 1rem;">
                        <a href="index.html">Вернуться на главную</a>
                    </p>
                </div>

                <div id="errorMessage" class="error-message" style="display: none; margin-top: 1rem;"></div>
                <div id="successMessage" class="success-message" style="display: none; margin-top: 1rem;"></div>
            </div>
        </main>
    </div>

    <script>
        // Простая регистрация без сложных зависимостей
        document.getElementById('registerForm').addEventListener('submit', async function (e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;
            const password = document.getElementById('password').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const role = document.getElementById('role').value;

            const errorDiv = document.getElementById('errorMessage');
            const successDiv = document.getElementById('successMessage');
            errorDiv.style.display = 'none';
            successDiv.style.display = 'none';

            // Валидация
            if (password !== confirmPassword) {
                errorDiv.textContent = 'Пароли не совпадают';
                errorDiv.style.display = 'block';
                return;
            }

            if (password.length < 6) {
                errorDiv.textContent = 'Пароль должен содержать минимум 6 символов';
                errorDiv.style.display = 'block';
                return;
            }

            if (!role) {
                errorDiv.textContent = 'Выберите роль';
                errorDiv.style.display = 'block';
                return;
            }

            const userData = {
                email,
                firstName,
                lastName,
                password,
                confirmPassword
            };

            const button = this.querySelector('button');
            button.disabled = true;
            button.textContent = 'Регистрация...';

            try {
                // Используем глобальную функцию apiService
                let response;
                if (role === 'HR') {
                    response = await window.apiService.registerHR(userData);
                } else {
                    response = await window.apiService.register(userData);
                }

                successDiv.textContent = 'Регистрация успешна! Перенаправляем на страницу входа...';
                successDiv.style.display = 'block';

                setTimeout(() => {
                    window.location.href = 'login.html';
                }, 2000);

            } catch (error) {
                errorDiv.textContent = error.message || 'Ошибка регистрации';
                errorDiv.style.display = 'block';
                button.disabled = false;
                button.textContent = 'Зарегистрироваться';
            }
        });

        // Загружаем API сервис если не загружен
        if (!window.apiService) {
            // Создаем простой API сервис для регистрации
            const API_BASE_URL = window.location.origin + "/api";

            window.apiService = {
                async register(userData) {
                    const response = await fetch(`${API_BASE_URL}/auth/register`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(userData)
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || 'Ошибка регистрации');
                    }

                    return data;
                },

                async registerHR(userData) {
                    const response = await fetch(`${API_BASE_URL}/auth/register-hr`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(userData)
                    });

                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || 'Ошибка регистрации HR');
                    }

                    return data;
                }
            };
        }
    </script>
</body>

</html>