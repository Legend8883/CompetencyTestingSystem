<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }

        .section {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .section h2 {
            margin-top: 0;
            color: #333;
        }

        .test-case {
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 10px;
        }

        button {
            padding: 10px 15px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            background: #0056b3;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .success {
            color: green;
            font-weight: bold;
        }

        .error {
            color: red;
            font-weight: bold;
        }

        .warning {
            color: orange;
            font-weight: bold;
        }

        pre {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }

        .step {
            margin-left: 20px;
            margin-bottom: 10px;
        }

        .status {
            display: inline-block;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
            margin-left: 10px;
        }

        .status.pending {
            background: #fff3cd;
            color: #856404;
        }

        .status.success {
            background: #d4edda;
            color: #155724;
        }

        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>

<body>
    <h1>üß™ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h1>

    <div class="section">
        <h2>1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞</h2>
        <button onclick="clearStorage()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ</button>
        <button onclick="checkAuth()">üîê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é</button>
        <div id="setup-status"></div>
    </div>

    <div class="section">
        <h2>2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ HR</h2>
        <div class="test-case">
            <h3>2.1 –°–æ–∑–¥–∞–Ω–∏–µ HR –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</h3>
            <button onclick="createHRUser()">–°–æ–∑–¥–∞—Ç—å HR –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
            <button onclick="loginAsHR()">–í–æ–π—Ç–∏ –∫–∞–∫ HR</button>
            <div id="hr-status"></div>
        </div>

        <div class="test-case">
            <h3>2.2 –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –≤–æ–ø—Ä–æ—Å–æ–≤</h3>
            <button onclick="createTestWithAllTypes()">–°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç (3 –≤–æ–ø—Ä–æ—Å–∞)</button>
            <button onclick="getHRTests()">–ü–æ–ª—É—á–∏—Ç—å –º–æ–∏ —Ç–µ—Å—Ç—ã</button>
            <div id="test-creation-status"></div>
        </div>

        <div class="test-case">
            <h3>2.3 –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
            <button onclick="createEmployee()">–°–æ–∑–¥–∞—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
            <button onclick="getEmployees()">–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</button>
            <div id="employee-status"></div>
        </div>

        <div class="test-case">
            <h3>2.4 –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É</h3>
            <button onclick="assignTestToEmployee()">–ù–∞–∑–Ω–∞—á–∏—Ç—å —Ç–µ—Å—Ç</button>
            <div id="assignment-status"></div>
        </div>
    </div>

    <div class="section">
        <h2>3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</h2>
        <div class="test-case">
            <h3>3.1 –í—Ö–æ–¥ –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</h3>
            <button onclick="loginAsEmployee()">–í–æ–π—Ç–∏ –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</button>
            <div id="employee-login-status"></div>
        </div>

        <div class="test-case">
            <h3>3.2 –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤</h3>
            <button onclick="getAvailableTests()">–ü–æ–ª—É—á–∏—Ç—å —Ç–µ—Å—Ç—ã</button>
            <div id="available-tests-status"></div>
        </div>

        <div class="test-case">
            <h3>3.3 –ü—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞</h3>
            <button onclick="startTestAsEmployee()">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
            <button onclick="simulateTestPassing()">üé≠ –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞</button>
            <div id="test-passing-status"></div>
        </div>

        <div class="test-case">
            <h3>3.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø—ã—Ç–æ–∫</h3>
            <button onclick="getEmployeeAttempts()">–ü–æ–ª—É—á–∏—Ç—å –º–æ–∏ –ø–æ–ø—ã—Ç–∫–∏</button>
            <div id="employee-attempts-status"></div>
        </div>
    </div>

    <div class="section">
        <h2>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∫ HR</h2>
        <div class="test-case">
            <h3>4.1 –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –æ—Ü–µ–Ω–∫—É</h3>
            <button onclick="getEvaluationAttempts()">–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</button>
            <button onclick="getOpenAnswers()">–ü–æ–ª—É—á–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã</button>
            <div id="evaluation-status"></div>
        </div>

        <div class="test-case">
            <h3>4.2 –û—Ü–µ–Ω–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</h3>
            <button onclick="evaluateAnswers()">–û—Ü–µ–Ω–∏—Ç—å –æ—Ç–≤–µ—Ç—ã</button>
            <button onclick="completeEvaluation()">–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É</button>
            <div id="grading-status"></div>
        </div>
    </div>

    <div class="section">
        <h2>5. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</h2>
        <div class="test-case">
            <h3>5.1 –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞</h3>
            <button onclick="runFullTest()">‚ñ∂Ô∏è –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ—Å—Ç</button>
            <button onclick="checkFinalResults()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
            <div id="final-status"></div>
        </div>
    </div>

    <div class="section">
        <h2>–õ–æ–≥–∏ –æ—Ç–ª–∞–¥–∫–∏</h2>
        <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
        <pre id="debug-log"></pre>
    </div>

    <script src="js/api.js"></script>
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let hrUserId = null;
        let employeeUserId = null;
        let testId = null;
        let attemptId = null;
        let answerId = null;

        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function log(message, type = 'info', data = null) {
            const debugLog = document.getElementById('debug-log');
            const timestamp = new Date().toLocaleTimeString();
            const typeIcon = {
                'info': '‚ÑπÔ∏è',
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            }[type] || '‚ÑπÔ∏è';

            debugLog.textContent += `${typeIcon} [${timestamp}] ${message}\n`;

            if (data) {
                debugLog.textContent += JSON.stringify(data, null, 2) + '\n';
            }

            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(message, data);
        }

        function clearLogs() {
            document.getElementById('debug-log').textContent = '';
        }

        function updateStatus(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `<span class="${type}">${message}</span>`;
            }
        }

        // 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞
        function clearStorage() {
            localStorage.clear();
            log('–•—Ä–∞–Ω–∏–ª–∏—â–µ –æ—á–∏—â–µ–Ω–æ', 'success');
            updateStatus('setup-status', '–•—Ä–∞–Ω–∏–ª–∏—â–µ –æ—á–∏—â–µ–Ω–æ', 'success');
        }

        function checkAuth() {
            const token = localStorage.getItem('authToken');
            const user = JSON.parse(localStorage.getItem('user') || 'null');

            log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', 'info', { hasToken: !!token, user: user });

            if (user) {
                updateStatus('setup-status', `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${user.email}, –†–æ–ª—å: ${user.role}`, 'success');
            } else {
                updateStatus('setup-status', '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω', 'warning');
            }
        }

        // 2. HR —Ñ—É–Ω–∫—Ü–∏–∏
        async function createHRUser() {
            try {
                log('–°–æ–∑–¥–∞–Ω–∏–µ HR –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...', 'info');
                const response = await apiService.registerHR({
                    email: 'hr@company3.com',
                    firstName: 'HR',
                    lastName: 'Manager',
                    password: 'hrpassword123',
                    confirmPassword: 'hrpassword123'
                });

                hrUserId = response.data.userId;
                log('HR –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω', 'success', response.data);
                updateStatus('hr-status', `HR —Å–æ–∑–¥–∞–Ω: ${response.data.email}`, 'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è HR –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è', 'error', error.message);
                updateStatus('hr-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function loginAsHR() {
            try {
                log('–í—Ö–æ–¥ –∫–∞–∫ HR...', 'info');
                const response = await apiService.login('hr@company3.com', 'hrpassword123');

                if (response.data.role !== 'HR') {
                    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è HR');
                }

                log('–í—Ö–æ–¥ –∫–∞–∫ HR –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success', response.data);
                updateStatus('hr-status', `–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω: ${response.data.email}`, 'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –∫–∞–∫ HR', 'error', error.message);
                updateStatus('hr-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function createTestWithAllTypes() {
            try {
                log('–°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –≤–æ–ø—Ä–æ—Å–æ–≤...', 'info');

                const testData = {
                    title: "–ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç –ø–æ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é",
                    description: "–¢–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Å–∏—Å—Ç–µ–º—ã",
                    timeLimitMinutes: 30,
                    passingScore: 70,
                    questions: [
                        {
                            text: "–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –≤ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–∏?",
                            type: "SINGLE_CHOICE",
                            maxScore: 10,
                            orderIndex: 0,
                            options: [
                                {
                                    text: "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö",
                                    isCorrect: true,
                                    orderIndex: 0
                                },
                                {
                                    text: "–¢–∏–ø –¥–∞–Ω–Ω—ã—Ö",
                                    isCorrect: false,
                                    orderIndex: 1
                                },
                                {
                                    text: "–§—É–Ω–∫—Ü–∏—è",
                                    isCorrect: false,
                                    orderIndex: 2
                                }
                            ]
                        },
                        {
                            text: "–ö–∞–∫–∏–µ –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —è–∑—ã–∫–æ–≤ —è–≤–ª—è—é—Ç—Å—è –æ–±—ä–µ–∫—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏?",
                            type: "MULTIPLE_CHOICE",
                            maxScore: 20,
                            orderIndex: 1,
                            options: [
                                {
                                    text: "Java",
                                    isCorrect: true,
                                    orderIndex: 0
                                },
                                {
                                    text: "C++",
                                    isCorrect: true,
                                    orderIndex: 1
                                },
                                {
                                    text: "Python",
                                    isCorrect: true,
                                    orderIndex: 2
                                },
                                {
                                    text: "HTML",
                                    isCorrect: false,
                                    orderIndex: 3
                                }
                            ]
                        },
                        {
                            text: "–û–ø–∏—à–∏—Ç–µ, —á—Ç–æ —Ç–∞–∫–æ–µ –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º –≤ –û–û–ü",
                            type: "OPEN_ANSWER",
                            maxScore: 30,
                            orderIndex: 2
                        }
                    ]
                };

                const response = await apiService.createTest(testData);
                testId = response.data.id;

                log('–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω', 'success', {
                    id: testId,
                    title: response.data.title,
                    questions: response.data.questions.length
                });

                updateStatus('test-creation-status',
                    `–¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω: ${response.data.title} (ID: ${testId}, –≤–æ–ø—Ä–æ—Å–æ–≤: ${response.data.questions.length})`,
                    'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–∞', 'error', error.message);
                updateStatus('test-creation-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function getHRTests() {
            try {
                log('–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ HR...', 'info');
                const response = await apiService.getHRTests();

                log('–¢–µ—Å—Ç—ã HR –ø–æ–ª—É—á–µ–Ω—ã', 'success', {
                    count: response.data.length,
                    tests: response.data.map(t => ({ id: t.id, title: t.title }))
                });

                updateStatus('test-creation-status',
                    `–ù–∞–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: ${response.data.length}`,
                    'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ HR', 'error', error.message);
                updateStatus('test-creation-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function createEmployee() {
            try {
                log('–°–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...', 'info');
                const response = await apiService.register({
                    email: 'employee@company.com',
                    firstName: '–ò–≤–∞–Ω',
                    lastName: '–ò–≤–∞–Ω–æ–≤',
                    password: 'password123',
                    confirmPassword: 'password123'
                });

                employeeUserId = response.data.userId;
                log('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–æ–∑–¥–∞–Ω', 'success', response.data);
                updateStatus('employee-status', `–°–æ—Ç—Ä—É–¥–Ω–∏–∫ —Å–æ–∑–¥–∞–Ω: ${response.data.email}`, 'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞', 'error', error.message);
                updateStatus('employee-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function getEmployees() {
            try {
                log('–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤...', 'info');
                const response = await apiService.getEmployees();

                log('–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ –ø–æ–ª—É—á–µ–Ω—ã', 'success', {
                    count: response.data.length,
                    employees: response.data.map(e => ({ id: e.id, name: `${e.firstName} ${e.lastName}` }))
                });

                updateStatus('employee-status',
                    `–ù–∞–π–¥–µ–Ω–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${response.data.length}`,
                    'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤', 'error', error.message);
                updateStatus('employee-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function assignTestToEmployee() {
            try {
                if (!testId) {
                    throw new Error('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç');
                }

                log('–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É...', 'info');

                // –°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å ID —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                const employeesResponse = await apiService.getEmployees();
                const employee = employeesResponse.data.find(e => e.email === 'employee@company.com');

                if (!employee) {
                    throw new Error('–°–æ—Ç—Ä—É–¥–Ω–∏–∫ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                }

                const response = await apiService.assignTest(testId, [employee.id], null);

                log('–¢–µ—Å—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω', 'success', response);
                updateStatus('assignment-status',
                    `–¢–µ—Å—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É ${employee.firstName} ${employee.lastName}`,
                    'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Ç–µ—Å—Ç–∞', 'error', error.message);
                updateStatus('assignment-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        // 3. –§—É–Ω–∫—Ü–∏–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
        async function loginAsEmployee() {
            try {
                log('–í—Ö–æ–¥ –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫...', 'info');
                const response = await apiService.login('employee@company.com', 'password123');

                if (response.data.role !== 'EMPLOYEE') {
                    throw new Error('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º');
                }

                log('–í—Ö–æ–¥ –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω', 'success', response.data);
                updateStatus('employee-login-status', `–í—Ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω: ${response.data.email}`, 'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫', 'error', error.message);
                updateStatus('employee-login-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function getAvailableTests() {
            try {
                log('–ü–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤...', 'info');
                const response = await apiService.getAvailableTests();

                if (response.data && response.data.length > 0) {
                    testId = response.data[0].id;
                    log('–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã', 'success', {
                        count: response.data.length,
                        firstTest: response.data[0]
                    });

                    updateStatus('available-tests-status',
                        `–ù–∞–π–¥–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: ${response.data.length}. –ü–µ—Ä–≤—ã–π: ${response.data[0].title}`,
                        'success');
                } else {
                    log('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤', 'warning');
                    updateStatus('available-tests-status', '–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤', 'warning');
                }

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤', 'error', error.message);
                updateStatus('available-tests-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function startTestAsEmployee() {
            try {
                if (!testId) {
                    throw new Error('–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã');
                }

                log('–ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞...', 'info');
                const response = await apiService.startTest(testId);
                attemptId = response.data.attemptId;

                log('–¢–µ—Å—Ç –Ω–∞—á–∞—Ç', 'success', {
                    attemptId: attemptId,
                    testTitle: response.data.testTitle,
                    questions: response.data.totalQuestions
                });

                updateStatus('test-passing-status',
                    `–¢–µ—Å—Ç –Ω–∞—á–∞—Ç: ${response.data.testTitle} (ID –ø–æ–ø—ã—Ç–∫–∏: ${attemptId})`,
                    'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∞', 'error', error.message);
                updateStatus('test-passing-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function simulateTestPassing() {
            try {
                if (!attemptId) {
                    throw new Error('–°–Ω–∞—á–∞–ª–∞ –Ω–∞—á–Ω–∏—Ç–µ —Ç–µ—Å—Ç');
                }

                log('–°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞...', 'info');

                // –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
                const progress1 = await apiService.getTestProgress(attemptId);
                const question1 = progress1.data.currentQuestion;
                log('–í–æ–ø—Ä–æ—Å 1 –ø–æ–ª—É—á–µ–Ω', 'info', question1);

                // –û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å 1
                let answer1;
                if (question1.type === 'SINGLE_CHOICE') {
                    answer1 = { selectedOptionIds: [question1.options[0].id] };
                }
                await apiService.submitAnswer(attemptId, question1.id, answer1);
                log('–û—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å 1 –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω', 'success');

                // –®–∞–≥ 2: –ü–µ—Ä–µ–π—Ç–∏ –∫ –≤–æ–ø—Ä–æ—Å—É 2
                // –í —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –Ω—É–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å —á–µ—Ä–µ–∑ API
                // –ó–¥–µ—Å—å —É–ø—Ä–æ—â–∞–µ–º –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏

                // –®–∞–≥ 3: –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç
                const completeResponse = await apiService.completeTest(attemptId);
                log('–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω', 'success', completeResponse);

                updateStatus('test-passing-status', '–¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω (—Å–∏–º—É–ª—è—Ü–∏—è)', 'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ —Ç–µ—Å—Ç–∞', 'error', error.message);
                updateStatus('test-passing-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function getEmployeeAttempts() {
            try {
                log('–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞...', 'info');
                const response = await apiService.getMyAttempts();

                log('–ü–æ–ø—ã—Ç–∫–∏ –ø–æ–ª—É—á–µ–Ω—ã', 'success', {
                    count: response.data.length,
                    attempts: response.data.map(a => ({
                        id: a.id,
                        test: a.testTitle,
                        status: a.status,
                        score: a.score
                    }))
                });

                if (response.data.length > 0) {
                    attemptId = response.data[0].id;
                }

                updateStatus('employee-attempts-status',
                    `–ù–∞–π–¥–µ–Ω–æ –ø–æ–ø—ã—Ç–æ–∫: ${response.data.length}`,
                    'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫', 'error', error.message);
                updateStatus('employee-attempts-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        // 4. –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
        async function getEvaluationAttempts() {
            try {
                // –°–Ω–∞—á–∞–ª–∞ –≤–æ–π—Ç–∏ –∫–∞–∫ HR
                await loginAsHR();

                log('–ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ...', 'info');
                const response = await apiService.getAttemptsForEvaluation();

                log('–ü–æ–ø—ã—Ç–∫–∏ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–ª—É—á–µ–Ω—ã', 'success', {
                    count: response.data.length,
                    attempts: response.data
                });

                if (response.data.length > 0) {
                    attemptId = response.data[0].id;
                }

                updateStatus('evaluation-status',
                    `–ü–æ–ø—ã—Ç–æ–∫ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ: ${response.data.length}`,
                    'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ', 'error', error.message);
                updateStatus('evaluation-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function getOpenAnswers() {
            try {
                log('–ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤...', 'info');
                const response = await apiService.getOpenAnswers();

                log('–û—Ç–∫—Ä—ã—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã –ø–æ–ª—É—á–µ–Ω—ã', 'success', {
                    count: response.data.length,
                    answers: response.data.map(a => ({
                        id: a.id,
                        question: a.questionText.substring(0, 50) + '...'
                    }))
                });

                if (response.data.length > 0) {
                    answerId = response.data[0].id;
                }

                updateStatus('evaluation-status',
                    `–û—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤: ${response.data.length}`,
                    'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤', 'error', error.message);
                updateStatus('evaluation-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function evaluateAnswers() {
            try {
                if (!answerId) {
                    throw new Error('–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã–µ –æ—Ç–≤–µ—Ç—ã');
                }

                log('–û—Ü–µ–Ω–∫–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤...', 'info');
                const response = await apiService.evaluateAnswer(answerId, 25); // –û—Ü–µ–Ω–∫–∞ 25 –∏–∑ 30

                log('–û—Ç–≤–µ—Ç –æ—Ü–µ–Ω–µ–Ω', 'success', response);
                updateStatus('grading-status', '–û—Ç–≤–µ—Ç —É—Å–ø–µ—à–Ω–æ –æ—Ü–µ–Ω–µ–Ω (25/30 –±–∞–ª–ª–æ–≤)', 'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –æ—Ü–µ–Ω–∫–∏ –æ—Ç–≤–µ—Ç–∞', 'error', error.message);
                updateStatus('grading-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function completeEvaluation() {
            try {
                if (!attemptId) {
                    throw new Error('–°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∏—Ç–µ –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ');
                }

                log('–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏...', 'info');
                const response = await apiService.completeEvaluation(attemptId);

                log('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success', response);
                updateStatus('grading-status', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞', 'success');

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏', 'error', error.message);
                updateStatus('grading-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        // 5. –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç
        async function runFullTest() {
            clearLogs();
            log('üöÄ –ù–∞—á–∞–ª–æ –ø–æ–ª–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞ —Å–∏—Å—Ç–µ–º—ã', 'info');

            try {
                // 1. –û—á–∏—Å—Ç–∫–∞
                clearStorage();
                await new Promise(resolve => setTimeout(resolve, 500));

                // 2. –°–æ–∑–¥–∞–Ω–∏–µ HR
                await createHRUser();
                await new Promise(resolve => setTimeout(resolve, 500));

                // 3. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞
                await createTestWithAllTypes();
                await new Promise(resolve => setTimeout(resolve, 500));

                // 4. –°–æ–∑–¥–∞–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                await createEmployee();
                await new Promise(resolve => setTimeout(resolve, 500));

                // 5. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ç–µ—Å—Ç–∞
                await assignTestToEmployee();
                await new Promise(resolve => setTimeout(resolve, 500));

                // 6. –í—Ö–æ–¥ –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
                await loginAsEmployee();
                await new Promise(resolve => setTimeout(resolve, 500));

                // 7. –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞
                await startTestAsEmployee();
                await new Promise(resolve => setTimeout(resolve, 500));

                // 8. –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è
                await simulateTestPassing();
                await new Promise(resolve => setTimeout(resolve, 1000));

                // 9. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∫ HR
                await getEvaluationAttempts();
                await new Promise(resolve => setTimeout(resolve, 500));

                await getOpenAnswers();
                await new Promise(resolve => setTimeout(resolve, 500));

                await evaluateAnswers();
                await new Promise(resolve => setTimeout(resolve, 500));

                await completeEvaluation();

                log('üéâ –ü–æ–ª–Ω—ã–π —Ç–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω!', 'success');
                updateStatus('final-status', '‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!', 'success');

            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –≤ –ø–æ–ª–Ω–æ–º —Ç–µ—Å—Ç–µ: ' + error.message, 'error');
                updateStatus('final-status', '‚ùå –û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        async function checkFinalResults() {
            try {
                log('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...', 'info');

                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ø—ã—Ç–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
                await loginAsEmployee();
                const attempts = await apiService.getMyAttempts();

                if (attempts.data.length > 0) {
                    const lastAttempt = attempts.data[0];
                    log('–ü–æ—Å–ª–µ–¥–Ω—è—è –ø–æ–ø—ã—Ç–∫–∞:', 'info', {
                        test: lastAttempt.testTitle,
                        status: lastAttempt.status,
                        score: lastAttempt.score,
                        passed: lastAttempt.passed
                    });

                    updateStatus('final-status',
                        `–§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: ${lastAttempt.testTitle}, ` +
                        `–°—Ç–∞—Ç—É—Å: ${lastAttempt.status}, ` +
                        `–û—Ü–µ–Ω–∫–∞: ${lastAttempt.score || '–ù–µ—Ç'}, ` +
                        `–ü—Ä–æ–π–¥–µ–Ω: ${lastAttempt.passed ? '–î–∞' : '–ù–µ—Ç'}`,
                        'success');
                }

            } catch (error) {
                log('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤', 'error', error.message);
                updateStatus('final-status', '–û—à–∏–±–∫–∞: ' + error.message, 'error');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function () {
            log('–°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≥–æ—Ç–æ–≤–∞', 'info');
        });
    </script>

    <button onclick="quickTest()">–ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç</button>

    <script>
        async function quickTest() {
            // 1. –í–æ–π—Ç–∏ –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫
            await apiService.login('employee@company.com', 'password123');

            // 2. –ü–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã
            const testsRes = await apiService.getAvailableTests();
            console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã:', testsRes.data?.length || 0);

            // 3. –ü–æ–ª—É—á–∏—Ç—å –º–æ–∏ –ø–æ–ø—ã—Ç–∫–∏
            const attemptsRes = await apiService.getMyAttempts();
            console.log('–ú–æ–∏ –ø–æ–ø—ã—Ç–∫–∏:', attemptsRes.data?.map(a => ({
                id: a.id,
                test: a.testTitle,
                status: a.status
            })));

            // 4. –í–æ–π—Ç–∏ –∫–∞–∫ HR
            await apiService.login('hr@company3.com', 'hrpassword123');

            // 5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–ø—ã—Ç–∫–∏ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
            const evalRes = await apiService.getAttemptsForEvaluation();
            console.log('–ü–æ–ø—ã—Ç–∫–∏ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ:', evalRes.data?.length || 0);
        }
    </script>
</body>

</html>