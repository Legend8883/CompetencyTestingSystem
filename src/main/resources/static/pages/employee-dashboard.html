<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="container">
        <nav class="navbar">
            <a href="../index.html" class="nav-brand">–ü–∞–Ω–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</a>
            <div style="display: flex; gap: 1rem;">
                <span style="color: var(--gray-text); align-self: center;">–°–æ—Ç—Ä—É–¥–Ω–∏–∫</span>
                <button onclick="authService.logout()" class="btn btn-outline">–í—ã–π—Ç–∏</button>
            </div>
        </nav>

        <main>
            <div class="dashboard-header">
                <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã</h2>
                <div class="user-info">
                    <div class="user-avatar" id="userInitials"></div>
                    <div>
                        <div id="userName"></div>
                        <div id="userEmail" style="font-size: 0.875rem; color: var(--gray-text);"></div>
                    </div>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>–î–æ—Å—Ç—É–ø–Ω–æ —Ç–µ—Å—Ç–æ–≤</h3>
                    <div class="stat-value" id="availableTests">0</div>
                </div>
                <div class="stat-card">
                    <h3>–ü—Ä–æ–π–¥–µ–Ω–æ</h3>
                    <div class="stat-value" id="completedTests">0</div>
                </div>
                <div class="stat-card">
                    <h3>–°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª</h3>
                    <div class="stat-value" id="averageScore">0</div>
                </div>
                <div class="stat-card">
                    <h3>–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</h3>
                    <div class="stat-value" id="successRate">0%</div>
                </div>
            </div>

            <h3 style="margin: 2rem 0 1rem;">–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞</th>
                            <th>–í–æ–ø—Ä–æ—Å—ã</th>
                            <th>–í—Ä–µ–º—è</th>
                            <th>–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª</th>
                            <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                        </tr>
                    </thead>
                    <tbody id="testsTable">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 2rem;">
                                –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ—Å—Ç–æ–≤...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <h3 style="margin: 2rem 0 1rem;">–ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–π</h3>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>–¢–µ—Å—Ç</th>
                            <th>–î–∞—Ç–∞</th>
                            <th>–ë–∞–ª–ª</th>
                            <th>–°—Ç–∞—Ç—É—Å</th>
                            <th>–†–µ–∑—É–ª—å—Ç–∞—Ç</th>
                        </tr>
                    </thead>
                    <tbody id="historyTable">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 2rem;">
                                –ò—Å—Ç–æ—Ä–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–π –ø—É—Å—Ç–∞
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- –°–µ–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ -->
            <div class="result-card"
                style="margin-top: 2rem; padding: 1.5rem; background: var(--white); border-radius: var(--radius-lg); border: 1px solid var(--gray-border);">
                <h3 style="margin-bottom: 1rem; color: var(--secondary-blue);">üìã –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3>
                <p style="color: var(--gray-text); margin-bottom: 1.5rem;">
                    –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü–æ–¥—Ä–æ–±–Ω–µ–µ" –≤ –∏—Å—Ç–æ—Ä–∏–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–π –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                </p>

                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-top: 1rem;">
                    <div style="padding: 1rem; background: var(--primary-verylight); border-radius: var(--radius);">
                        <div style="font-size: 0.875rem; color: var(--gray-text);">–°—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏</div>
                        <div id="evaluation-status"
                            style="font-weight: 600; color: var(--primary-blue); margin-top: 0.25rem;">
                            –ó–∞–≥—Ä—É–∑–∫–∞...
                        </div>
                    </div>

                    <div style="padding: 1rem; background: var(--primary-verylight); border-radius: var(--radius);">
                        <div style="font-size: 0.875rem; color: var(--gray-text);">–ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞</div>
                        <div id="last-evaluation"
                            style="font-weight: 600; color: var(--primary-blue); margin-top: 0.25rem;">
                            –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö
                        </div>
                    </div>
                </div>

                <div style="margin-top: 1.5rem;">
                    <button onclick="viewAllResults()" class="btn btn-outline">
                        üìä –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    </button>
                    <button onclick="refreshDashboard()" class="btn btn-outline" style="margin-left: 1rem;">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>–ü–∞–Ω–µ–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</p>
        </footer>
    </div>

    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ —á—Ç–æ–±—ã DOM –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∑–∏–ª—Å—è
            setTimeout(() => {
                const existingTable = document.getElementById('testsTable');

                if (!existingTable) {
                    console.log('‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ —Ç–µ—Å—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞, —Å–æ–∑–¥–∞—é...');

                    // –ò—â–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ "–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è"
                    const headings = document.querySelectorAll('h3');

                    headings.forEach(h3 => {
                        if (h3.textContent.includes('–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è')) {
                            // –°–æ–∑–¥–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –ø–æ—Å–ª–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞
                            const tableHtml = `
                        <div class="table-container" style="margin-top: 1rem;">
                            <table>
                                <thead>
                                    <tr>
                                        <th>–ù–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞</th>
                                        <th>–í–æ–ø—Ä–æ—Å—ã</th>
                                        <th>–í—Ä–µ–º—è</th>
                                        <th>–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª</th>
                                        <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                                    </tr>
                                </thead>
                                <tbody id="testsTable">
                                    <tr>
                                        <td colspan="5" style="text-align: center; padding: 2rem;">
                                            –ó–∞–≥—Ä—É–∑–∫–∞...
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    `;

                            h3.insertAdjacentHTML('afterend', tableHtml);
                            console.log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞!');
                        }
                    });
                } else {
                    console.log('‚úÖ –¢–∞–±–ª–∏—Ü–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç');
                }
            }, 500);
        });


        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ API —Ä–∞–±–æ—Ç–∞–µ—Ç
        console.log('API Service –¥–æ—Å—Ç—É–ø–µ–Ω:', window.apiService ? '–î–∞' : '–ù–µ—Ç');
        console.log('–¢–æ–∫–µ–Ω:', localStorage.getItem('authToken') ? '–ï—Å—Ç—å' : '–ù–µ—Ç');
        console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', JSON.parse(localStorage.getItem('user') || '{}'));

        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM –∑–∞–≥—Ä—É–∂–µ–Ω, –Ω–∞—á–∏–Ω–∞—é –∑–∞–≥—Ä—É–∑–∫—É –¥–∞–Ω–Ω—ã—Ö...');

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const token = localStorage.getItem('authToken');
            const user = JSON.parse(localStorage.getItem('user') || 'null');

            if (!token || !user || user.role !== 'EMPLOYEE') {
                console.log('–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é...');
                window.location.href = '../login.html';
                return;
            }

            console.log('–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫:', user.email, '–†–æ–ª—å:', user.role);

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.getElementById('userName').textContent = user.firstName + ' ' + user.lastName;
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userInitials').textContent =
                (user.firstName[0] || '') + (user.lastName[0] || '');

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            setTimeout(() => {
                loadDashboardData();
            }, 500);
        });

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –∏ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        document.addEventListener('DOMContentLoaded', async function () {
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            const token = localStorage.getItem('authToken');
            const user = JSON.parse(localStorage.getItem('user') || 'null');

            if (!token || !user || user.role !== 'EMPLOYEE') {
                window.location.href = '../login.html';
                return;
            }

            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            document.getElementById('userName').textContent = user.firstName + ' ' + user.lastName;
            document.getElementById('userEmail').textContent = user.email;
            document.getElementById('userInitials').textContent =
                (user.firstName[0] || '') + (user.lastName[0] || '');

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
            await loadDashboardData();
        });

        async function testLoad() {
            console.clear();
            console.log('=== –¢–ï–°–¢ –ó–ê–ì–†–£–ó–ö–ò ===');

            try {
                const response = await apiService.getAvailableTests();
                console.log('–ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç API:', response);
                console.log('Data:', response.data);

                tests = response.data || [];

                console.log('–¢–µ—Å—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', tests);
                console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ:', tests.length);

                if (tests.length > 0) {
                    console.log('–ü–µ—Ä–≤—ã–π —Ç–µ—Å—Ç:', JSON.stringify(tests[0], null, 2));

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                    console.log('–ï—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã?', 'questionCount' in tests[0]);
                    console.log('–ï—Å—Ç—å isActive?', 'isActive' in tests[0]);
                    console.log('–ï—Å—Ç—å passingScore?', 'passingScore' in tests[0]);
                    console.log('–ï—Å—Ç—å timeLimitMinutes?', 'timeLimitMinutes' in tests[0]);

                    alert(`–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${tests.length} —Ç–µ—Å—Ç–æ–≤\n` +
                        `–ü–µ—Ä–≤—ã–π: ${tests[0].title}\n` +
                        `isActive: ${tests[0].isActive}\n` +
                        `–í–æ–ø—Ä–æ—Å–æ–≤: ${tests[0].questionCount}`);

                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤ —Ç–∞–±–ª–∏—Ü–µ
                    updateTestsTable(tests);
                } else {
                    alert('–¢–µ—Å—Ç—ã –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–ª–∏ –ø—É—Å—Ç—ã–µ');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞:', error);
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            }
        }

        function processTests(tests) {
            if (!tests || !Array.isArray(tests)) return [];

            return tests.map(test => {
                // –£–±–µ–¥–∏–º—Å—è —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è –µ—Å—Ç—å
                return {
                    id: test.id || 0,
                    title: test.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è',
                    description: test.description || '',
                    timeLimitMinutes: test.timeLimitMinutes || 30,
                    passingScore: test.passingScore || 70,
                    isActive: test.isActive !== undefined ? test.isActive : true,
                    questionCount: test.questionCount || (test.questions ? test.questions.length : 0),
                    questions: test.questions || [],
                    createdBy: test.createdBy || { firstName: 'HR', lastName: '' },
                    createdAt: test.createdAt,
                    // –î–æ–±–∞–≤–ª—è–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
                    maxPossibleScore: test.maxPossibleScore || 100,
                    updatedAt: test.updatedAt
                };
            });
        }

        async function loadDashboardData() {
            console.log('=== START loadDashboardData ===');

            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                document.getElementById('testsTable').innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; padding: 2rem;">
                    üïê –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
                </td>
            </tr>
        `;

                console.log('1. –ó–∞–ø—Ä–∞—à–∏–≤–∞—é –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã...');
                const testsResponse = await apiService.getAvailableTests();
                console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã:', testsResponse.data);

                const tests = testsResponse.data || [];
                console.log('–¢–µ—Å—Ç–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ:', tests.length);

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–∏ –ø–æ–ø—ã—Ç–∫–∏
                let myAttempts = [];
                try {
                    console.log('2. –ó–∞–ø—Ä–∞—à–∏–≤–∞—é –º–æ–∏ –ø–æ–ø—ã—Ç–∫–∏...');
                    const attemptsResponse = await apiService.getMyAttempts();
                    myAttempts = attemptsResponse.data || [];
                    console.log('–ü–æ–ø—ã—Ç–æ–∫ –ø–æ–ª—É—á–µ–Ω–æ:', myAttempts.length);
                } catch (attemptsError) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ø—ã—Ç–æ–∫:', attemptsError);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏
                updateEvaluationStatus(myAttempts);

                // 1. –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–µ—Å—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –Ω–∞—á–∞—Ç—ã –∏–ª–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
                // –í–ê–ñ–ù–û: –£–±–µ–¥–∏–º—Å—è —á—Ç–æ myAttempts –Ω–µ undefined –∏ –µ—Å—Ç—å testId
                const unavailableTestIds = myAttempts
                    .filter(attempt => {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ attempt –∏ testId —Å—É—â–µ—Å—Ç–≤—É—é—Ç
                        if (!attempt || !attempt.testId) return false;

                        const status = attempt.status;
                        return status === 'IN_PROGRESS' ||
                            status === 'EVALUATING' ||
                            status === 'EVALUATED' ||
                            status === 'COMPLETED';
                    })
                    .map(attempt => {
                        console.log('–ë–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ç–µ—Å—Ç ID:', attempt.testId, '—Å—Ç–∞—Ç—É—Å:', attempt.status);
                        return attempt.testId;
                    });

                console.log('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ID —Ç–µ—Å—Ç–æ–≤:', unavailableTestIds);

                // 2. –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã = –∞–∫—Ç–∏–≤–Ω—ã–µ + –Ω–µ –Ω–∞—á–∞—Ç—ã–µ
                const availableTests = tests.filter(test => {
                    if (!test || !test.id) return false;

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å true/false/null)
                    const isActive = test.isActive === true;

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ—Å—Ç –Ω–µ –≤ —Å–ø–∏—Å–∫–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
                    // –ï—Å–ª–∏ myAttempts –ø—É—Å—Ç–æ–π –∏–ª–∏ testId –Ω–µ—Ç –≤ unavailableTestIds
                    const notStarted = !unavailableTestIds.includes(test.id);

                    console.log(`–¢–µ—Å—Ç ${test.id} "${test.title}": isActive=${isActive}, notStarted=${notStarted}`);

                    return isActive && notStarted;
                });

                console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:', availableTests);

                // 3. –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('availableTests').textContent = availableTests.length;

                // 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ø—ã—Ç–∫–∞–º
                const totalAttempts = myAttempts.length;
                const completedAttempts = myAttempts.filter(a =>
                    a.status === 'EVALUATED' || a.status === 'EVALUATING'
                ).length;

                document.getElementById('completedTests').textContent = completedAttempts;

                // 5. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
                const evaluatedAttempts = myAttempts.filter(a => a.status === 'EVALUATED');

                if (evaluatedAttempts.length > 0) {
                    const totalScore = evaluatedAttempts.reduce((sum, a) => sum + (a.score || 0), 0);
                    const avgScore = Math.round(totalScore / evaluatedAttempts.length);
                    const passedCount = evaluatedAttempts.filter(a => a.passed === true).length;
                    const successRate = Math.round((passedCount / evaluatedAttempts.length) * 100);

                    document.getElementById('averageScore').textContent = avgScore;
                    document.getElementById('successRate').textContent = successRate + '%';
                } else {
                    document.getElementById('averageScore').textContent = '0';
                    document.getElementById('successRate').textContent = '0%';
                }

                // 6. –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—ã
                updateTestsTable(availableTests);
                updateHistoryTable(myAttempts);

                console.log('=== END loadDashboardData SUCCESS ===');

            } catch (error) {
                console.error('=== ERROR in loadDashboardData ===', error);

                document.getElementById('testsTable').innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; padding: 2rem; color: #ef4444;">
                    ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}
                </td>
            </tr>
        `;
            }
        }

        function updateTestsTable(tests) {
            console.log('updateTestsTable –≤—ã–∑–≤–∞–Ω —Å:', tests);

            const tbody = document.getElementById('testsTable');

            if (!tests || tests.length === 0) {
                console.log('–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è');
                tbody.innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; padding: 3rem; color: #64748b;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üì≠</div>
                    <div style="font-size: 1.25rem; margin-bottom: 0.5rem;">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤</div>
                    <div style="font-size: 0.875rem; margin-bottom: 1.5rem;">
                        –í–æ–∑–º–æ–∂–Ω–æ, –≤—Å–µ —Ç–µ—Å—Ç—ã —É–∂–µ –ø—Ä–æ–π–¥–µ–Ω—ã –∏–ª–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ
                    </div>
                    <button onclick="loadDashboardData()" class="btn btn-outline">
                        üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </td>
            </tr>
        `;
                return;
            }

            console.log('–û—Ç–æ–±—Ä–∞–∂–∞—é', tests.length, '—Ç–µ—Å—Ç–æ–≤');

            tbody.innerHTML = tests.map(test => {
                console.log('–¢–µ—Å—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:', test);

                // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –≤—Ä–µ–º—è
                const timeText = test.timeLimitMinutes < 60 ?
                    `${test.timeLimitMinutes} –º–∏–Ω` :
                    `${Math.floor(test.timeLimitMinutes / 60)} —á ${test.timeLimitMinutes % 60} –º–∏–Ω`;

                return `
            <tr>
                <td>
                    <strong style="color: var(--primary-blue);">${test.title || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</strong>
                    ${test.description ? `<br><small style="color: var(--gray-text);">${test.description}</small>` : ''}
                </td>
                <td>${test.questionCount || 0}</td>
                <td>${timeText}</td>
                <td>${test.passingScore || 0}%</td>
                <td>
                    <button class="btn btn-primary btn-small" 
                            onclick="startTest(${test.id})"
                            style="padding: 0.5rem 1rem; font-size: 0.875rem;">
                        –ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç
                    </button>
                </td>
            </tr>
        `;
            }).join('');

            console.log('–¢–∞–±–ª–∏—Ü–∞ —Ç–µ—Å—Ç–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∞');
        }

        function updateHistoryTable(attempts) {
            const tbody = document.getElementById('historyTable');

            if (!attempts || attempts.length === 0) {
                tbody.innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; padding: 2rem; color: #64748b;">
                    –í—ã –µ—â–µ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏–ª–∏ —Ç–µ—Å—Ç—ã
                </td>
            </tr>
        `;
                return;
            }

            // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –¥–∞—Ç–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–Ω–æ–≤—ã–µ —Å–≤–µ—Ä—Ö—É)
            const sortedAttempts = [...attempts].sort((a, b) => {
                const dateA = a.completedAt ? new Date(a.completedAt) : new Date(a.startedAt);
                const dateB = b.completedAt ? new Date(b.completedAt) : new Date(b.startedAt);
                return dateB - dateA;
            });

            tbody.innerHTML = sortedAttempts.map(attempt => {
                const statusLabel = getAttemptStatusLabel(attempt.status);
                const statusClass = getAttemptStatusClass(attempt.status);
                const date = attempt.completedAt || attempt.startedAt;

                let resultHtml = '';
                if (attempt.status === 'EVALUATED') {
                    resultHtml = attempt.passed ?
                        '<span style="color: #10b981; font-weight: 600;">‚úì –ü—Ä–æ–π–¥–µ–Ω</span>' :
                        '<span style="color: #ef4444; font-weight: 600;">‚úó –ù–µ –ø—Ä–æ–π–¥–µ–Ω</span>';
                } else if (attempt.status === 'EVALUATING') {
                    resultHtml = '<span style="color: #f59e0b; font-weight: 600;">‚è≥ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ</span>';
                } else if (attempt.status === 'IN_PROGRESS') {
                    resultHtml = '<span style="color: #2563eb; font-weight: 600;">‚ñ∂ –í –ø—Ä–æ—Ü–µ—Å—Å–µ</span>';
                }

                return `
            <tr>
                <td>${attempt.testTitle || '–¢–µ—Å—Ç'}</td>
                <td>${formatDate(date)}</td>
                <td>${attempt.score !== null && attempt.score !== undefined ?
                        attempt.score + ' –±–∞–ª–ª–æ–≤' : '–û–∂–∏–¥–∞–µ—Ç –æ—Ü–µ–Ω–∫–∏'}</td>
                <td>
                    <span class="status ${statusClass}">${statusLabel}</span>
                </td>
                <td>
                    ${resultHtml}
                    ${attempt.status === 'EVALUATED' ? `
                        <button onclick="viewResults(${attempt.id})" 
                                class="btn btn-outline btn-small" 
                                style="margin-left: 10px; padding: 2px 8px; font-size: 12px;">
                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ
                        </button>
                    ` : ''}
                </td>
            </tr>
        `;
            }).join('');
        }

        async function viewResults(attemptId) {
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            window.location.href = `test-results.html?attemptId=${attemptId}`;
        }

        function getAttemptStatusLabel(status) {
            const statuses = {
                'IN_PROGRESS': '–í –ø—Ä–æ—Ü–µ—Å—Å–µ',
                'COMPLETED': '–ó–∞–≤–µ—Ä—à–µ–Ω',
                'EVALUATING': '‚è≥ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ HR',
                'EVALUATED': '‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ'
            };
            return statuses[status] || status;
        }

        function getAttemptStatusClass(status) {
            switch (status) {
                case 'EVALUATED': return 'status-active';
                case 'EVALUATING': return 'status-pending';
                case 'COMPLETED': return 'status-inactive';
                default: return 'status-inactive';
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('ru-RU', {
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return dateString;
            }
        }

        async function viewTestResult(attemptId) {
            try {
                // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∂–µ–º alert
                const attemptsResponse = await apiService.getMyAttempts();
                const attempt = attemptsResponse.data?.find(a => a.id === attemptId);

                if (attempt) {
                    alert(`–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ "${attempt.testTitle}":\n\n` +
                        `–û—Ü–µ–Ω–∫–∞: ${attempt.score || '–ù–µ—Ç –æ—Ü–µ–Ω–∫–∏'}\n` +
                        `–°—Ç–∞—Ç—É—Å: ${attempt.passed ? '–ü—Ä–æ—à–µ–ª ‚úì' : '–ù–µ –ø—Ä–æ—à–µ–ª ‚úó'}\n` +
                        `–î–∞—Ç–∞: ${formatDate(attempt.completedAt)}`);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: ' + error.message);
            }
        }

        function formatTime(minutes) {
            if (!minutes) return '0 –º–∏–Ω';
            if (minutes < 60) {
                return `${minutes} –º–∏–Ω`;
            }
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return mins > 0 ? `${hours} —á ${mins} –º–∏–Ω` : `${hours} —á`;
        }

        function startTest(testId) {
            console.log('–ù–∞—á–∏–Ω–∞—é —Ç–µ—Å—Ç —Å ID:', testId);

            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ testId –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
            if (!testId || isNaN(testId)) {
                alert('–û—à–∏–±–∫–∞: –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π ID —Ç–µ—Å—Ç–∞');
                return;
            }

            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
            window.location.href = `take-test-simple.html?id=${testId}`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function viewAllResults() {
            const attempts = JSON.parse(localStorage.getItem('myAttempts') || '[]');
            const evaluatedAttempts = attempts.filter(a => a.status === 'EVALUATED');

            if (evaluatedAttempts.length === 0) {
                alert('–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤');
                return;
            }

            // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥–ª—è –≤—ã–±–æ—Ä–∞
            let message = '–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞:\n\n';
            evaluatedAttempts.forEach((attempt, index) => {
                const date = formatDate(attempt.completedAt || attempt.startedAt);
                const score = attempt.score || 0;
                message += `${index + 1}. ${attempt.testTitle} (${score} –±–∞–ª–ª–æ–≤, ${date})\n`;
            });

            const choice = prompt(message + '\n–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Ç–µ—Å—Ç–∞:');
            if (!choice) return;

            const index = parseInt(choice) - 1;
            if (index >= 0 && index < evaluatedAttempts.length) {
                const attemptId = evaluatedAttempts[index].id;
                window.location.href = `test-results.html?attemptId=${attemptId}`;
            } else {
                alert('–ù–µ–≤–µ—Ä–Ω—ã–π –Ω–æ–º–µ—Ä');
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞—à–±–æ—Ä–¥–∞
        function refreshDashboard() {
            loadDashboardData();
            showNotification('–î–∞—à–±–æ—Ä–¥ –æ–±–Ω–æ–≤–ª–µ–Ω', 'success');
        }

        // –§—É–Ω–∫—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = type === 'success' ? 'success-message' : 'info-message';
            notification.style.cssText = 'position: fixed; top: 20px; right: 20px; padding: 1rem; z-index: 1000; border-radius: var(--radius); box-shadow: var(--shadow-lg);';
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        async function loadDashboardData() {
            console.log('=== START loadDashboardData ===');

            try {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
                document.getElementById('testsTable').innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; padding: 2rem;">
                    üïê –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...
                </td>
            </tr>
        `;

                console.log('1. –ó–∞–ø—Ä–∞—à–∏–≤–∞—é –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã...');
                const testsResponse = await apiService.getAvailableTests();
                console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã:', testsResponse.data);

                const tests = testsResponse.data || [];
                console.log('–¢–µ—Å—Ç–æ–≤ –ø–æ–ª—É—á–µ–Ω–æ:', tests.length);

                // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–∏ –ø–æ–ø—ã—Ç–∫–∏
                let myAttempts = [];
                try {
                    console.log('2. –ó–∞–ø—Ä–∞—à–∏–≤–∞—é –º–æ–∏ –ø–æ–ø—ã—Ç–∫–∏...');
                    const attemptsResponse = await apiService.getMyAttempts();
                    myAttempts = attemptsResponse.data || [];
                    console.log('–ü–æ–ø—ã—Ç–æ–∫ –ø–æ–ª—É—á–µ–Ω–æ:', myAttempts.length);
                } catch (attemptsError) {
                    console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–ø—ã—Ç–æ–∫:', attemptsError);
                }

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–æ–≤–µ—Ä–∫–∏
                updateEvaluationStatus(myAttempts);

                // 1. –§–∏–ª—å—Ç—Ä—É–µ–º —Ç–µ—Å—Ç—ã –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ –Ω–∞—á–∞—Ç—ã –∏–ª–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
                // –í–ê–ñ–ù–û: –£–±–µ–¥–∏–º—Å—è —á—Ç–æ myAttempts –Ω–µ undefined –∏ –µ—Å—Ç—å testId
                const unavailableTestIds = myAttempts
                    .filter(attempt => {
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ attempt –∏ testId —Å—É—â–µ—Å—Ç–≤—É—é—Ç
                        if (!attempt || !attempt.testId) return false;

                        const status = attempt.status;
                        return status === 'IN_PROGRESS' ||
                            status === 'EVALUATING' ||
                            status === 'EVALUATED' ||
                            status === 'COMPLETED';
                    })
                    .map(attempt => {
                        console.log('–ë–ª–æ–∫–∏—Ä—É—é—â–∏–π —Ç–µ—Å—Ç ID:', attempt.testId, '—Å—Ç–∞—Ç—É—Å:', attempt.status);
                        return attempt.testId;
                    });

                console.log('–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ ID —Ç–µ—Å—Ç–æ–≤:', unavailableTestIds);

                // 2. –î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã = –∞–∫—Ç–∏–≤–Ω—ã–µ + –Ω–µ –Ω–∞—á–∞—Ç—ã–µ
                const availableTests = tests.filter(test => {
                    if (!test || !test.id) return false;

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∞ (–º–æ–∂–µ—Ç –±—ã—Ç—å true/false/null)
                    const isActive = test.isActive === true;

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ç–µ—Å—Ç –Ω–µ –≤ —Å–ø–∏—Å–∫–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
                    // –ï—Å–ª–∏ myAttempts –ø—É—Å—Ç–æ–π –∏–ª–∏ testId –Ω–µ—Ç –≤ unavailableTestIds
                    const notStarted = !unavailableTestIds.includes(test.id);

                    console.log(`–¢–µ—Å—Ç ${test.id} "${test.title}": isActive=${isActive}, notStarted=${notStarted}`);

                    return isActive && notStarted;
                });

                console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:', availableTests);

                // 3. –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById('availableTests').textContent = availableTests.length;

                // 4. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø–æ–ø—ã—Ç–∫–∞–º
                const totalAttempts = myAttempts.length;
                const completedAttempts = myAttempts.filter(a =>
                    a.status === 'EVALUATED' || a.status === 'EVALUATING'
                ).length;

                document.getElementById('completedTests').textContent = completedAttempts;

                // 5. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª –∏ —É—Å–ø–µ—à–Ω–æ—Å—Ç—å
                const evaluatedAttempts = myAttempts.filter(a => a.status === 'EVALUATED');

                if (evaluatedAttempts.length > 0) {
                    const totalScore = evaluatedAttempts.reduce((sum, a) => sum + (a.score || 0), 0);
                    const avgScore = Math.round(totalScore / evaluatedAttempts.length);
                    const passedCount = evaluatedAttempts.filter(a => a.passed === true).length;
                    const successRate = Math.round((passedCount / evaluatedAttempts.length) * 100);

                    document.getElementById('averageScore').textContent = avgScore;
                    document.getElementById('successRate').textContent = successRate + '%';
                } else {
                    document.getElementById('averageScore').textContent = '0';
                    document.getElementById('successRate').textContent = '0%';
                }

                // 6. –û–±–Ω–æ–≤–ª—è–µ–º —Ç–∞–±–ª–∏—Ü—ã
                updateTestsTable(availableTests);
                updateHistoryTable(myAttempts);

                console.log('=== END loadDashboardData SUCCESS ===');

            } catch (error) {
                console.error('=== ERROR in loadDashboardData ===', error);

                document.getElementById('testsTable').innerHTML = `
            <tr>
                <td colspan="5" style="text-align: center; padding: 2rem; color: #ef4444;">
                    ‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ${error.message}
                </td>
            </tr>
        `;
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
        function updateEvaluationStatus(attempts) {
            const evaluatingCount = attempts.filter(a => a.status === 'EVALUATING').length;
            const evaluatedCount = attempts.filter(a => a.status === 'EVALUATED').length;

            document.getElementById('evaluation-status').innerHTML = `
        <span style="color: ${evaluatingCount > 0 ? 'var(--warning)' : 'var(--success)'}">
            ${evaluatingCount > 0 ? '‚è≥ –ù–∞ –ø—Ä–æ–≤–µ—Ä–∫–µ: ' + evaluatingCount : '‚úì –í—Å–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã'}
        </span>
    `;

            // –ù–∞—Ö–æ–¥–∏–º –ø–æ—Å–ª–µ–¥–Ω—é—é –ø—Ä–æ–≤–µ—Ä–∫—É
            const evaluatedAttempts = attempts.filter(a => a.status === 'EVALUATED');
            if (evaluatedAttempts.length > 0) {
                const latest = evaluatedAttempts.sort((a, b) =>
                    new Date(b.completedAt) - new Date(a.completedAt)
                )[0];

                document.getElementById('last-evaluation').textContent =
                    `${latest.testTitle} (${formatDate(latest.completedAt)})`;
            } else {
                document.getElementById('last-evaluation').textContent = '–ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤';
            }
        }

        async function testRealApi() {
            console.clear();
            console.log('=== –ü–†–û–í–ï–†–ö–ê –†–ï–ê–õ–¨–ù–û–ì–û API ===');

            try {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–µ—Å—Ç—ã
                const testsResponse = await apiService.getAvailableTests();
                console.log('‚úÖ API –æ—Ç–≤–µ—Ç–∏–ª');
                console.log('–°—Ç–∞—Ç—É—Å:', testsResponse.success);
                console.log('–°–æ–æ–±—â–µ–Ω–∏–µ:', testsResponse.message);

                if (testsResponse.data) {
                    console.log('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤:', testsResponse.data.length);

                    if (testsResponse.data.length > 0) {
                        const firstTest = testsResponse.data[0];
                        console.log('–ü–µ—Ä–≤—ã–π —Ç–µ—Å—Ç:', firstTest);
                        console.log('ID:', firstTest.id);
                        console.log('–ù–∞–∑–≤–∞–Ω–∏–µ:', firstTest.title);
                        console.log('isActive:', firstTest.isActive);
                        console.log('questionCount:', firstTest.questionCount);
                        console.log('passingScore:', firstTest.passingScore);
                        console.log('timeLimitMinutes:', firstTest.timeLimitMinutes);

                        alert(`‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç!\n\n` +
                            `–ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ç–µ—Å—Ç–æ–≤: ${testsResponse.data.length}\n` +
                            `–ü–µ—Ä–≤—ã–π —Ç–µ—Å—Ç: "${firstTest.title}"\n` +
                            `–ê–∫—Ç–∏–≤–µ–Ω: ${firstTest.isActive ? '–î–∞' : '–ù–µ—Ç'}\n` +
                            `–í–æ–ø—Ä–æ—Å–æ–≤: ${firstTest.questionCount || '–Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö'}`);
                    } else {
                        alert('‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ç–µ—Å—Ç–æ–≤ –Ω–µ—Ç');
                    }
                } else {
                    console.log('‚ùå –î–∞–Ω–Ω—ã–µ –ø—É—Å—Ç—ã–µ:', testsResponse);
                    alert('API –≤–µ—Ä–Ω—É–ª –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ');
                }

            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ API:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ API: ' + error.message);
            }
        }

        <button onclick="testRealApi()" class="btn btn-outline">
            üß™ –¢–µ—Å—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ API
        </button>
    </script>
</body>

</html>