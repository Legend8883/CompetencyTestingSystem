<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест API</title>
</head>

<body>
    <h1>Тестирование API</h1>

    <div>
        <button onclick="testAvailableTests()">Тест: Доступные тесты</button>
        <button onclick="testMyAttempts()">Тест: Мои попытки</button>
        <button onclick="testAuth()">Тест: Авторизация</button>
    </div>

    <div id="result" style="margin-top: 20px; padding: 20px; border: 1px solid #ccc; background: #f5f5f5;"></div>

    <script>
        const API_BASE_URL = window.location.origin + "/api";

        function getAuthToken() {
            return localStorage.getItem('authToken');
        }

        async function testAvailableTests() {
            const token = getAuthToken();
            if (!token) {
                showResult('❌ Нет токена авторизации');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/employee/tests/available`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                showResult(`
                    ✅ Status: ${response.status}<br>
                    ✅ Success: ${data.success}<br>
                    ✅ Message: ${data.message}<br>
                    ✅ Data count: ${data.data ? data.data.length : 0}<br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `);
            } catch (error) {
                showResult(`❌ Ошибка: ${error.message}`);
            }
        }

        async function testMyAttempts() {
            const token = getAuthToken();
            if (!token) {
                showResult('❌ Нет токена авторизации');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/employee/attempts`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const data = await response.json();
                showResult(`
                    ✅ Status: ${response.status}<br>
                    ✅ Success: ${data.success}<br>
                    ✅ Message: ${data.message}<br>
                    ✅ Data count: ${data.data ? data.data.length : 0}<br>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `);
            } catch (error) {
                showResult(`❌ Ошибка: ${error.message}`);
            }
        }

        function testAuth() {
            const token = getAuthToken();
            const user = JSON.parse(localStorage.getItem('user') || 'null');

            showResult(`
                Токен: ${token ? '✅ Есть' : '❌ Нет'}<br>
                Пользователь: ${user ? user.email : '❌ Нет'}<br>
                Роль: ${user ? user.role : '❌ Нет'}<br>
                Имя: ${user ? user.firstName : '❌ Нет'}
            `);
        }

        function showResult(html) {
            document.getElementById('result').innerHTML = html;
        }

        // Проверяем авторизацию при загрузке
        document.addEventListener('DOMContentLoaded', () => {
            if (!getAuthToken()) {
                alert('Сначала авторизуйтесь!');
                window.location.href = '../login.html';
            }
        });
    </script>
</body>

</html>