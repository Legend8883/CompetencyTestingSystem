<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</title>
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .result-summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            border-radius: var(--radius-lg);
            margin-bottom: 2rem;
            text-align: center;
        }

        .result-passed {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .result-failed {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .question-result {
            background: var(--white);
            border-radius: var(--radius);
            border: 1px solid var(--gray-border);
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: all 0.2s ease;
        }

        .question-result.correct {
            border-left: 4px solid var(--success);
            background: #f0fdf4;
        }

        .question-result.incorrect {
            border-left: 4px solid var(--error);
            background: #fef2f2;
        }

        .question-result.pending {
            border-left: 4px solid var(--warning);
            background: #fffbeb;
        }

        .option-result {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            border-radius: var(--radius);
            border: 1px solid var(--gray-border);
            background: var(--white);
        }

        .option-result.correct {
            background: #d1fae5;
            border-color: #10b981;
        }

        .option-result.selected {
            background: #dbeafe;
            border-color: #2563eb;
        }

        .option-result.selected.correct {
            background: #bbf7d0;
            border-color: #059669;
        }

        .option-result.selected.incorrect {
            background: #fecaca;
            border-color: #ef4444;
        }

        .score-badge {
            display: inline-block;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.875rem;
            margin-left: 0.5rem;
        }

        .score-good {
            background: var(--success);
            color: white;
        }

        .score-bad {
            background: var(--error);
            color: white;
        }

        .score-pending {
            background: var(--warning);
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: var(--radius);
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.9;
        }
    </style>
</head>

<body>
    <div class="container">
        <nav class="navbar">
            <a href="#" onclick="goBack()" class="nav-brand">‚Üê –ù–∞–∑–∞–¥</a>
            <div style="display: flex; gap: 1rem;">
                <button onclick="printResults()" class="btn btn-outline btn-small">
                    üìÑ –ü–µ—á–∞—Ç—å
                </button>
                <button onclick="exportResults()" class="btn btn-outline btn-small">
                    üì• –≠–∫—Å–ø–æ—Ä—Ç
                </button>
            </div>
        </nav>

        <main id="results-container">
            <div style="text-align: center; padding: 4rem;">
                <div class="loading-spinner"></div>
                <p style="color: var(--gray-text); margin-top: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤...</p>
            </div>
        </main>
    </div>

    <script src="../js/api.js"></script>
    <script src="../js/auth.js"></script>
    <script>
        // –ü–æ–ª—É—á–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                attemptId: params.get('attemptId'),
                view: params.get('view') || 'employee' // 'employee' –∏–ª–∏ 'hr'
            };
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        async function loadResults() {
            const params = getUrlParams();
            const attemptId = params.attemptId;
            const view = params.view;

            if (!attemptId) {
                showError('ID –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ —É–∫–∞–∑–∞–Ω');
                return;
            }

            try {
                let response;

                if (view === 'hr') {
                    // –î–ª—è HR –∑–∞–≥—Ä—É–∂–∞–µ–º –ø–æ–ª–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
                    response = await apiService.getAttemptDetailsForHR(attemptId);
                } else {
                    // –î–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                    response = await apiService.getAttemptResults(attemptId);
                }

                const results = response.data;
                renderResults(results, view);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + error.message);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function renderResults(results, view) {
            const container = document.getElementById('results-container');

            if (!results) {
                container.innerHTML = `
                    <div class="error-message" style="text-align: center; padding: 2rem;">
                        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–î–∞–Ω–Ω—ã–µ –ø–æ —ç—Ç–æ–π –ø–æ–ø—ã—Ç–∫–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç</p>
                    </div>
                `;
                return;
            }

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–ª–æ–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
            const resultClass = results.passed ? 'result-passed' : 'result-failed';
            const resultText = results.passed ? '–¢–ï–°–¢ –ü–†–û–ô–î–ï–ù' : '–¢–ï–°–¢ –ù–ï –ü–†–û–ô–î–ï–ù';
            const resultIcon = results.passed ? 'üéâ' : 'üòî';

            // –§–æ—Ä–º–∏—Ä—É–µ–º HTML –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
            let questionsHtml = '';

            if (results.answers && results.answers.length > 0) {
                questionsHtml = results.answers.map((answer, index) => {
                    const questionClass = getQuestionClass(answer);
                    const questionStatus = getQuestionStatus(answer);

                    return `
                        <div class="question-result ${questionClass}">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                                <h4 style="margin: 0;">–í–æ–ø—Ä–æ—Å ${index + 1}</h4>
                                <span class="score-badge ${getScoreBadgeClass(answer)}">
                                    ${getQuestionScore(answer)} / ${answer.questionMaxScore}
                                </span>
                            </div>
                            
                            <p style="margin-bottom: 1rem; font-weight: 500;">${answer.questionText}</p>
                            
                            ${renderAnswerContent(answer, view)}
                            
                            <div style="margin-top: 1rem; font-size: 0.875rem; color: var(--gray-text);">
                                ${questionStatus}
                            </div>
                        </div>
                    `;
                }).join('');
            } else {
                questionsHtml = `
                    <div style="text-align: center; padding: 2rem; color: var(--gray-text);">
                        <p>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º</p>
                    </div>
                `;
            }

            // –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–ª–Ω—ã–π HTML
            container.innerHTML = `
                <div class="result-summary ${resultClass}">
                    <h1 style="margin-bottom: 0.5rem;">${results.testTitle}</h1>
                    <p style="margin-bottom: 1rem; opacity: 0.9;">${results.user ? results.user.firstName + ' ' + results.user.lastName : '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞'}</p>
                    
                    <div style="font-size: 1.5rem; margin-bottom: 1rem;">
                        ${resultIcon} ${resultText}
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${results.score || 0}</div>
                            <div class="stat-label">–ë–∞–ª–ª—ã</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-value">${results.passingScore}</div>
                            <div class="stat-label">–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-value">${results.correctAnswersCount || 0}/${results.totalQuestions || 0}</div>
                            <div class="stat-label">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-value">${calculatePercentage(results.score, results.maxPossibleScore)}%</div>
                            <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                        </div>
                    </div>
                    
                    <div style="font-size: 0.875rem; opacity: 0.8;">
                        –ó–∞–≤–µ—Ä—à–µ–Ω: ${formatDate(results.completedAt || results.startedAt)}
                    </div>
                </div>
                
                <h2 style="margin: 2rem 0 1rem;">–î–µ—Ç–∞–ª–∏ –æ—Ç–≤–µ—Ç–æ–≤</h2>
                <div id="questions-list">
                    ${questionsHtml}
                </div>
                
                ${view === 'hr' && results.status === 'COMPLETED' ? `
                    <div style="margin-top: 2rem; padding: 1.5rem; background: var(--warning-light); border-radius: var(--radius); border: 1px solid var(--warning);">
                    <h4 style="margin-bottom: 0.5rem;">‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ HR</h4>
                    <p style="margin-bottom: 1rem;">–í —ç—Ç–æ–º —Ç–µ—Å—Ç–µ –µ—Å—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –æ—Ü–µ–Ω–∫–∏ HR.</p>
                    <button onclick="showEvaluationForm()" class="btn btn-warning">
                        –û—Ü–µ–Ω–∏—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã
                    </button>
                </div>
                ` : ''}
                
                ${view === 'hr' ? `
                    <div style="display: flex; gap: 1rem; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--gray-border);">
                        <button onclick="completeEvaluation(${results.attemptId})" class="btn btn-success">
                            –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É
                        </button>
                    </div>
                ` : ''}
            `;
        }

        function showEvaluationForm() {
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –æ—Ü–µ–Ω–∫–∏ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
            const container = document.getElementById('questions-list');
            const questions = container.querySelectorAll('.question-result');

            questions.forEach(question => {
                const questionType = question.querySelector('.question-type')?.textContent || '';
                if (questionType.includes('OPEN_ANSWER')) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏
                    const scoreInput = `
                <div style="margin-top: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                        –û—Ü–µ–Ω–∫–∞ HR:
                    </label>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <input type="number" 
                               class="hr-score-input"
                               min="0" 
                               max="10"
                               value="0"
                               style="flex: 1; padding: 0.5rem; border: 1px solid var(--gray-border); border-radius: var(--radius);">
                        <span style="color: var(--gray-text);">/ 10</span>
                        <button onclick="saveHRScore(this)" class="btn btn-primary btn-small">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </div>
            `;

                    // –ù–∞—Ö–æ–¥–∏–º –º–µ—Å—Ç–æ –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ (–ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞)
                    const answerDiv = question.querySelector('.answer-content');
                    if (answerDiv) {
                        answerDiv.insertAdjacentHTML('afterend', scoreInput);
                    }
                }
            });
        }

        async function saveHRScore(button) {
            const input = button.previousElementSibling.previousElementSibling;
            const score = parseInt(input.value);
            const questionId = button.closest('.question-result').dataset.questionId;

            if (isNaN(score) || score < 0 || score > 10) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –±–∞–ª–ª (0-10)');
                return;
            }

            try {
                // –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const params = getUrlParams();
                // –ù—É–∂–µ–Ω answerId, –Ω–æ —É –Ω–∞—Å —Ç–æ–ª—å–∫–æ questionId
                // –í—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
                button.textContent = '‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ';
                button.disabled = true;
                input.disabled = true;

                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                const scoreDisplay = button.closest('.question-result').querySelector('.question-score');
                if (scoreDisplay) {
                    scoreDisplay.textContent = `${score} / 10`;
                }

            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        async function completeEvaluation(attemptId) {
            if (!confirm('–ó–∞–≤–µ—Ä—à–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —ç—Ç–æ–π –ø–æ–ø—ã—Ç–∫–∏?\n–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–∑–º–µ–Ω–∏—Ç—å –æ—Ü–µ–Ω–∫–∏ –±—É–¥–µ—Ç –Ω–µ–ª—å–∑—è.')) {
                return;
            }

            try {
                await apiService.completeEvaluation(attemptId);
                alert('–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É.');

                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
                window.location.reload();

            } catch (error) {
                alert('–û—à–∏–±–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏: ' + error.message);
            }
        }

        // –†–µ–Ω–¥–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        function renderAnswerContent(answer, view) {
            if (answer.questionType === 'OPEN_ANSWER') {
                return `
                    <div style="margin-bottom: 1rem;">
                        <div style="font-weight: 500; margin-bottom: 0.5rem;">–û—Ç–≤–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞:</div>
                        <div style="background: var(--gray-light); padding: 1rem; border-radius: var(--radius); white-space: pre-wrap;">
                            ${answer.userAnswer || answer.openAnswerText || '–û—Ç–≤–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}
                        </div>
                    </div>
                    
                    ${view === 'hr' && !answer.assignedScore ? `
                        <div style="margin-top: 1rem;">
                            <label style="display: block; margin-bottom: 0.5rem; font-weight: 500;">
                                –û—Ü–µ–Ω–∫–∞ (0 - ${answer.questionMaxScore} –±–∞–ª–ª–æ–≤):
                            </label>
                            <div style="display: flex; gap: 1rem; align-items: center;">
                                <input type="number" 
                                       id="score-${answer.questionId}"
                                       min="0" 
                                       max="${answer.questionMaxScore}"
                                       value="0"
                                       style="flex: 1; padding: 0.5rem; border: 1px solid var(--gray-border); border-radius: var(--radius);">
                                <span style="color: var(--gray-text);">/ ${answer.questionMaxScore}</span>
                                <button onclick="saveOpenAnswerScore(${answer.questionId})" class="btn btn-primary btn-small">
                                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    ` : `
                        <div style="margin-top: 0.5rem;">
                            <strong>–û—Ü–µ–Ω–∫–∞:</strong> ${answer.assignedScore || answer.autoScore || 0} / ${answer.questionMaxScore}
                        </div>
                    `}
                `;
            } else {
                // –î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –≤—ã–±–æ—Ä–æ–º
                let optionsHtml = '';

                if (answer.selectedOptions && answer.selectedOptions.length > 0) {
                    optionsHtml = answer.selectedOptions.map(option => {
                        const optionClass = getOptionClass(option);
                        return `
                            <div class="option-result ${optionClass}">
                                <div style="margin-right: 0.75rem;">
                                    ${option.selected ? '‚úì' : '‚óã'}
                                </div>
                                <div style="flex: 1;">
                                    ${option.text}
                                </div>
                                ${option.isCorrect ? '‚úÖ' : ''}
                            </div>
                        `;
                    }).join('');
                } else {
                    optionsHtml = '<p style="color: var(--gray-text);">–í–∞—Ä–∏–∞–Ω—Ç—ã –Ω–µ –≤—ã–±—Ä–∞–Ω—ã</p>';
                }

                return `
                    <div style="margin-bottom: 1rem;">
                        <div style="font-weight: 500; margin-bottom: 0.5rem;">–í—ã–±—Ä–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã:</div>
                        ${optionsHtml}
                    </div>
                    
                    <div style="margin-top: 0.5rem;">
                        <strong>–ê–≤—Ç–æ-–æ—Ü–µ–Ω–∫–∞:</strong> ${answer.autoScore || 0} / ${answer.questionMaxScore}
                    </div>
                `;
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getQuestionClass(answer) {
            if (answer.questionType === 'OPEN_ANSWER' && !answer.assignedScore) {
                return 'pending';
            }
            return answer.isCorrect ? 'correct' : 'incorrect';
        }

        function getQuestionStatus(answer) {
            if (answer.questionType === 'OPEN_ANSWER') {
                if (answer.assignedScore !== null && answer.assignedScore !== undefined) {
                    return `‚úì –û—Ü–µ–Ω–µ–Ω–æ HR: ${answer.assignedScore} –±–∞–ª–ª–æ–≤`;
                } else if (answer.autoScore !== null && answer.autoScore !== undefined) {
                    return `–ê–≤—Ç–æ-–æ—Ü–µ–Ω–∫–∞: ${answer.autoScore} –±–∞–ª–ª–æ–≤`;
                } else {
                    return '‚è≥ –û–∂–∏–¥–∞–µ—Ç –æ—Ü–µ–Ω–∫–∏ HR';
                }
            } else {
                return answer.isCorrect ? '‚úì –ü—Ä–∞–≤–∏–ª—å–Ω–æ' : '‚úó –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ';
            }
        }

        function getScoreBadgeClass(answer) {
            if (answer.questionType === 'OPEN_ANSWER' && !answer.assignedScore) {
                return 'score-pending';
            }
            return answer.isCorrect ? 'score-good' : 'score-bad';
        }

        function getQuestionScore(answer) {
            if (answer.questionType === 'OPEN_ANSWER') {
                return answer.assignedScore || answer.autoScore || 0;
            } else {
                return answer.autoScore || 0;
            }
        }

        function getOptionClass(option) {
            let classes = [];
            if (option.selected) classes.push('selected');
            if (option.isCorrect) classes.push('correct');
            if (option.selected && !option.isCorrect) classes.push('incorrect');
            return classes.join(' ');
        }

        function calculatePercentage(score, max) {
            if (!max || max === 0) return 0;
            return Math.round((score / max) * 100);
        }

        function formatDate(dateString) {
            if (!dateString) return '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function showError(message) {
            const container = document.getElementById('results-container');
            container.innerHTML = `
                <div class="error-message" style="text-align: center; padding: 2rem;">
                    <h3 style="color: var(--error); margin-bottom: 1rem;">–û—à–∏–±–∫–∞</h3>
                    <p>${message}</p>
                    <button onclick="goBack()" class="btn btn-outline" style="margin-top: 1rem;">
                        ‚Üê –ù–∞–∑–∞–¥
                    </button>
                </div>
            `;
        }

        function goBack() {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –æ—Ç–∫—É–¥–∞ –ø—Ä–∏—à–ª–∏
            const params = getUrlParams();

            if (params.view === 'employee') {
                window.location.href = 'employee-dashboard.html';
            } else if (params.view === 'hr') {
                window.location.href = 'hr-attempts.html';
            } else {
                window.history.back();
            }
        }

        function printResults() {
            window.print();
        }

        function exportResults() {
            alert('–≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ PDF');
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        }

        async function saveOpenAnswerScore(questionId) {
            const input = document.getElementById(`score-${questionId}`);
            const score = parseInt(input.value);

            if (isNaN(score) || score < 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –±–∞–ª–ª');
                return;
            }

            try {
                // –ù—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å answerId –¥–ª—è —ç—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
                // –í—Ä–µ–º–µ–Ω–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
                alert(`–û—Ü–µ–Ω–∫–∞ ${score} —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞`);
                input.disabled = true;
            } catch (error) {
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        function evaluateTest(attemptId) {
            // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –æ—Ü–µ–Ω–∫–∏ –¥–ª—è HR
            window.location.href = `evaluation.html?attemptId=${attemptId}`;
        }

        function sendResultsToEmail(attemptId) {
            const email = prompt('–í–≤–µ–¥–∏—Ç–µ email –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:');
            if (email) {
                alert(`–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ ${email}`);
            }
        }

        function downloadCertificate(attemptId) {
            alert('–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è...');
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('authToken');
            if (!token) {
                window.location.href = '../login.html';
                return;
            }

            loadResults();
        });
    </script>
</body>

</html>